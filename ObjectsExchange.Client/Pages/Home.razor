@page "/"
@using ObjectsExchange.Client.Services
@inject IApiAdapter ApiAdapter


<PageTitle>Home</PageTitle>

<AuthorizeView Roles="Administrator">
    <Authorized>
        <RadzenButton Click="Download">
            <RadzenBadge Text="Base Download" BadgeStyle="BadgeStyle.Primary" />
        </RadzenButton>
    </Authorized>
    <NotAuthorized>
        Not Autorized
    </NotAuthorized>
</AuthorizeView>



@body


@code
{
    const string FileName = "Readme.md";
    private MarkupString? body;
    RenderFragment StringToHtml(string htmlString)
    {
        return new RenderFragment(b => b.AddMarkupContent(0, htmlString));
    }
    protected override async Task OnInitializedAsync()
    {
        var markDown = await ApiAdapter.GetReadmeAsync();
        body = new MarkupString(Markdig.Markdown.ToHtml(markDown));


        // if (System.IO.File.Exists(FileName))
        // {
        //     var markDown = await System.IO.File.ReadAllTextAsync(FileName);
        //     body = new MarkupString(Markdig.Markdown.ToHtml(markDown));
        // }
        // else
        // {

        //     body =new MarkupString( $"The file {FileName} do not exist !");
        // }

    }
    async Task Download()
    {
        var jsonString = await ApiAdapter.GetDataBaseBackupAsync();
        await SabatexJsInterop.DownloadStringAsFile("SabatexExchange.json", jsonString);
    }

}