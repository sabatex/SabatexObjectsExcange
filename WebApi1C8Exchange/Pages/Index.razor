@page "/"
@attribute [Authorize(Roles ="Admin, User")]
@using Microsoft.EntityFrameworkCore
@using Radzen
@using System.Text.Unicode
@using WebApiDocumentsExchange.Models
@using WebApiDocumentsExchange.Data
@inject ExchangeDbContext dbContext
@inject DialogService DialogService
@inject IJSRuntime JSRuntime


<PageTitle>Index</PageTitle>

<RadzenDataGrid Data="@items" TItem="ObjectExchange"  @ref="grid"
                AllowFiltering="true"
                AllowColumnResize="true"
                AllowPaging="true"
                PageSize="10"
                AllowSorting="true"
                SelectionMode="DataGridSelectionMode.Single"
                @bind-Value=@selectedItems
                >
    <Columns>
         <RadzenDataGridColumn TItem="ObjectExchange" Property="Sender" Title="Sender" MinWidth="200px"/>
         <RadzenDataGridColumn TItem="ObjectExchange" Property="Destination" Title="Destination" MinWidth="100px"/>
         <RadzenDataGridColumn TItem="ObjectExchange" Property="ObjectId" Title="Object Id" MinWidth="100px"/>
         <RadzenDataGridColumn TItem="ObjectExchange" Property="ObjectType" Title="Object Type" MinWidth="200px"/>
         <RadzenDataGridColumn TItem="ObjectExchange" Property="DateStamp" Title="DateStamp" MinWidth="100px"/>
         <RadzenDataGridColumn TItem="ObjectExchange" Property="ObjectJSON" Title="JSON" MinWidth="100px"/>
         <RadzenDataGridColumn TItem="ObjectExchange" Context="sampleBlazorModelsSampleOrder" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Width="100px">
            <Template Context="client">
                 <RadzenButton Icon="delete" ButtonStyle="ButtonStyle.Danger" Size="ButtonSize.Small" Class="m-1" Click="@(args => DeleteRow(client))" @onclick:stopPropagation="true" />
            </Template>
        </RadzenDataGridColumn>

     </Columns>
</RadzenDataGrid>


@code {
    private RadzenDataGrid<ObjectExchange>? grid;
    private IEnumerable<ObjectExchange>? items;
    private IList<ObjectExchange>? selectedItems;

    protected override void OnInitialized()
    {
        items = dbContext.ObjectExchanges;
    }

    async Task DeleteRow(ObjectExchange? item)
    {
        if (item == null) return;
        var dialogResult = await DialogService.Confirm("Ви впевнені?",
                                        "Видалення запису",
                                        new ConfirmOptions() { OkButtonText = "Так", CancelButtonText = "Ні" });
        if (dialogResult == true)
        {
               dbContext.Remove(item);
               dbContext.SaveChanges();
               if (grid != null)  await grid.Reload();
        }
    }

  

}